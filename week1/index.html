<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Titanic EDA Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      min-height: 100vh;
      color: white;
      padding: 28px;
      font-family: Arial, sans-serif;

      /* Titanic background with dark overlay */
      background: 
        linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)),
        url("https://upload.wikimedia.org/wikipedia/commons/f/fd/RMS_Titanic_3.jpg") no-repeat center center fixed;
      background-size: cover;
    }
    h1, h2 { text-align: center; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .panel {
      background: rgba(50,0,20,0.8);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    canvas, #heatmap {
      width: 100% !important;
      height: 400px !important;
    }
  </style>
</head>
<body>
  <h1>ðŸš¢ Titanic Dataset EDA Dashboard</h1>
  <div class="grid">
    <div class="panel"><h2>Survival by Sex</h2><canvas id="survivalSex"></canvas></div>
    <div class="panel"><h2>Survival by Class</h2><canvas id="survivalClass"></canvas></div>
    <div class="panel"><h2>Survival by Embarkation Port</h2><canvas id="survivalEmbark"></canvas></div>
    <div class="panel"><h2>Survival by Family Size</h2><canvas id="survivalFamily"></canvas></div>
    <div class="panel"><h2>Survival by Fare Quartile</h2><canvas id="survivalFare"></canvas></div>
    <div class="panel"><h2>Age Distribution</h2><canvas id="ageDist"></canvas></div>
    <div class="panel"><h2>Fare Distribution</h2><canvas id="fareDist"></canvas></div>
    <div class="panel"><h2>Age vs Survival</h2><canvas id="ageSurvival"></canvas></div>
    <div class="panel"><h2>Correlation Heatmap</h2><div id="heatmap"></div></div>
  </div>

<script>
async function loadData() {
  const response = await fetch("train.csv"); // Titanic dataset in repo
  const text = await response.text();
  const rows = text.split("\n").slice(1).map(r => r.split(","));
  const headers = ["PassengerId","Survived","Pclass","Name","Sex","Age","SibSp","Parch","Ticket","Fare","Cabin","Embarked"];
  return rows.filter(r => r.length >= headers.length).map(r => {
    const obj = {};
    headers.forEach((h,i) => obj[h] = r[i]);
    obj.Survived = +obj.Survived;
    obj.Pclass = +obj.Pclass;
    obj.Age = parseFloat(obj.Age) || null;
    obj.SibSp = +obj.SibSp;
    obj.Parch = +obj.Parch;
    obj.Fare = parseFloat(obj.Fare) || 0;
    return obj;
  });
}

function drawChart(ctx, type, labels, data, label, background='rgba(255,99,132,0.7)') {
  new Chart(ctx, {
    type: type,
    data: { labels: labels, datasets: [{ label: label, data: data, backgroundColor: background }] },
    options: {
      responsive: true,
      plugins: { legend: { labels: { color: 'white' } } },
      scales: { x: { ticks: { color: 'white' } }, y: { ticks: { color: 'white' } } }
    }
  });
}

loadData().then(data => {
  // Utility
  const pct = x => +(x*100).toFixed(1);

  // --- Survival by Sex ---
  const sexGroups = { male: {surv:0,total:0}, female: {surv:0,total:0} };
  data.forEach(p => { sexGroups[p.Sex].total++; if(p.Survived===1) sexGroups[p.Sex].surv++; });
  drawChart(document.getElementById('survivalSex').getContext('2d'),
    'bar', Object.keys(sexGroups),
    Object.values(sexGroups).map(g => pct(g.surv/g.total)), 'Survival %');

  // --- Survival by Class ---
  const classGroups = {1:{surv:0,total:0},2:{surv:0,total:0},3:{surv:0,total:0}};
  data.forEach(p => { classGroups[p.Pclass].total++; if(p.Survived===1) classGroups[p.Pclass].surv++; });
  drawChart(document.getElementById('survivalClass').getContext('2d'),
    'bar', Object.keys(classGroups),
    Object.values(classGroups).map(g => pct(g.surv/g.total)), 'Survival %');

  // --- Survival by Embarkation Port ---
  const portNames = { 'C':'Cherbourg', 'Q':'Queenstown', 'S':'Southampton' };
  const portGroups = {};
  data.forEach(p => {
    const port = portNames[p.Embarked] || 'Unknown';
    if(!portGroups[port]) portGroups[port] = {surv:0,total:0};
    portGroups[port].total++; if(p.Survived===1) portGroups[port].surv++;
  });
  drawChart(document.getElementById('survivalEmbark').getContext('2d'),
    'bar', Object.keys(portGroups),
    Object.values(portGroups).map(g => pct(g.surv/g.total)), 'Survival %');

  // --- Survival by Family Size ---
  const famGroups = {};
  data.forEach(p => {
    const fam = p.SibSp + p.Parch;
    if(!famGroups[fam]) famGroups[fam] = {surv:0,total:0};
    famGroups[fam].total++; if(p.Survived===1) famGroups[fam].surv++;
  });
  drawChart(document.getElementById('survivalFamily').getContext('2d'),
    'bar', Object.keys(famGroups),
    Object.values(famGroups).map(g => pct(g.surv/g.total)), 'Survival %');

  // --- Survival by Fare Quartile ---
  const fares = data.map(p => p.Fare).sort((a,b)=>a-b);
  const q1 = fares[Math.floor(fares.length*0.25)];
  const q2 = fares[Math.floor(fares.length*0.5)];
  const q3 = fares[Math.floor(fares.length*0.75)];
  const quartGroups = {Q1:{surv:0,total:0},Q2:{surv:0,total:0},Q3:{surv:0,total:0},Q4:{surv:0,total:0}};
  data.forEach(p => {
    let q = 'Q1';
    if(p.Fare>q3) q='Q4'; else if(p.Fare>q2) q='Q3'; else if(p.Fare>q1) q='Q2';
    quartGroups[q].total++; if(p.Survived===1) quartGroups[q].surv++;
  });
  drawChart(document.getElementById('survivalFare').getContext('2d'),
    'bar', Object.keys(quartGroups),
    Object.values(quartGroups).map(g => pct(g.surv/g.total)), 'Survival %');

  // --- Age Distribution ---
  drawChart(document.getElementById('ageDist').getContext('2d'),
    'histogram' in Chart.registry ? 'histogram' : 'bar',
    data.filter(p=>p.Age).map(p=>p.Age), [], 'Age');

  // --- Fare Distribution ---
  drawChart(document.getElementById('fareDist').getContext('2d'),
    'line', data.map((_,i)=>i), data.map(p=>p.Fare), 'Fare');

  // --- Age vs Survival ---
  const survAges = data.filter(p=>p.Age).map(p=>({x:p.Age,y:p.Survived}));
  new Chart(document.getElementById('ageSurvival').getContext('2d'), {
    type:'scatter',
    data:{ datasets:[{label:'Age vs Survival',data:survAges,backgroundColor:'rgba(255,99,132,0.7)'}]},
    options:{scales:{x:{title:{display:true,text:'Age'},ticks:{color:'white'}},y:{title:{display:true,text:'Survived'},ticks:{color:'white'}}}}
  });

  // --- Correlation Heatmap ---
  const features = ['Survived','Pclass','Age','SibSp','Parch','Fare'];
  const matrix = features.map(f1 =>
    features.map(f2 => {
      const arr1 = data.map(d => +d[f1] || 0);
      const arr2 = data.map(d => +d[f2] || 0);
      const mean1 = arr1.reduce((a,b)=>a+b,0)/arr1.length;
      const mean2 = arr2.reduce((a,b)=>a+b,0)/arr2.length;
      const num = arr1.map((x,i)=>(x-mean1)*(arr2[i]-mean2)).reduce((a,b)=>a+b,0);
      const den = Math.sqrt(
        arr1.map(x=>(x-mean1)**2).reduce((a,b)=>a+b,0) *
        arr2.map(x=>(x-mean2)**2).reduce((a,b)=>a+b,0)
      );
      return (den===0?0:num/den).toFixed(2);
    })
  );
  Plotly.newPlot('heatmap', [{
    z: matrix,
    x: features,
    y: features,
    type: 'heatmap',
    colorscale: 'Reds',
    showscale: true
  }], {
    margin: { t: 50 },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    font: {color: 'white'}
  });
});
</script>
</body>
</html>
