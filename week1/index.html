<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Titanic Survivors' Tales — EDA Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      color: #fff;
      text-align: center;
      background: #1a000d;
    }

    /* Background Titanic image overlay */
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: url("https://upload.wikimedia.org/wikipedia/commons/f/fd/RMS_Titanic_3.jpg") no-repeat center center fixed;
      background-size: cover;
      opacity: 0.25;  /* faded so charts are visible */
      z-index: -1;
    }

    h1 {
      margin: 20px 0;
      font-size: 28px;
      color: #fff;
      text-shadow: 1px 1px 4px #000;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .chart-container {
      background: rgba(0, 0, 0, 0.65); /* dark glassy container */
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.6);
    }

    canvas {
      max-width: 100%;
    }
  </style>
</head>
<body>
  <h1>Titanic Survivors' Tales — EDA Dashboard</h1>

  <div class="dashboard">
    <div class="chart-container"><canvas id="classChart"></canvas></div>
    <div class="chart-container"><canvas id="genderChart"></canvas></div>
    <div class="chart-container"><canvas id="ageChart"></canvas></div>
    <div class="chart-container"><canvas id="familyChart"></canvas></div>
    <div class="chart-container"><canvas id="embarkChart"></canvas></div>
    <div class="chart-container"><canvas id="fareChart"></canvas></div>
    <div class="chart-container"><canvas id="corrHeatmap"></canvas></div>
  </div>

  <script>
    const CSV_URL = "train.csv";

    Papa.parse(CSV_URL, {
      download: true,
      header: true,
      dynamicTyping: true,
      complete: function(results) {
        const data = results.data;

        // Clean data
        const passengers = data.filter(d => d.Survived !== undefined && d.Survived !== "");

        // Utility function
        function groupBy(arr, key) {
          return arr.reduce((acc, row) => {
            const k = row[key];
            acc[k] = acc[k] || [];
            acc[k].push(row);
            return acc;
          }, {});
        }

        // === Survival by Class ===
        const classGroups = groupBy(passengers, "Pclass");
        const classLabels = Object.keys(classGroups).sort();
        const classSurvival = classLabels.map(c => {
          const group = classGroups[c];
          return group.filter(p => p.Survived === 1).length / group.length * 100;
        });

        new Chart(document.getElementById("classChart"), {
          type: "bar",
          data: {
            labels: classLabels,
            datasets: [{
              label: "% Survived",
              data: classSurvival,
              backgroundColor: ["#800000", "#b3003b", "#ff4d6d"]
            }]
          },
          options: {
            plugins: { title: { display: true, text: "Survival by Passenger Class" } },
            scales: { y: { ticks: { color: "#fff" }, beginAtZero: true } }
          }
        });

        // === Survival by Gender ===
        const genderGroups = groupBy(passengers, "Sex");
        const genderLabels = Object.keys(genderGroups);
        const genderSurvival = genderLabels.map(g => {
          const group = genderGroups[g];
          return group.filter(p => p.Survived === 1).length / group.length * 100;
        });

        new Chart(document.getElementById("genderChart"), {
          type: "bar",
          data: {
            labels: genderLabels,
            datasets: [{
              label: "% Survived",
              data: genderSurvival,
              backgroundColor: ["#ff4d6d", "#ff99ac"]
            }]
          },
          options: {
            plugins: { title: { display: true, text: "Survival by Gender" } },
            scales: { y: { ticks: { color: "#fff" }, beginAtZero: true } }
          }
        });

        // === Survival by Age Group ===
        function ageBucket(age) {
          if (age < 12) return "Child";
          if (age < 18) return "Teen";
          if (age < 40) return "Adult";
          return "Senior";
        }
        passengers.forEach(p => p.AgeGroup = ageBucket(p.Age));
        const ageGroups = groupBy(passengers, "AgeGroup");
        const ageLabels = Object.keys(ageGroups);
        const ageSurvival = ageLabels.map(a => {
          const group = ageGroups[a];
          return group.filter(p => p.Survived === 1).length / group.length * 100;
        });

        new Chart(document.getElementById("ageChart"), {
          type: "bar",
          data: {
            labels: ageLabels,
            datasets: [{
              label: "% Survived",
              data: ageSurvival,
              backgroundColor: ["#800000", "#b3003b", "#ff4d6d", "#ff99ac"]
            }]
          },
          options: {
            plugins: { title: { display: true, text: "Survival by Age Group" } },
            scales: { y: { ticks: { color: "#fff" }, beginAtZero: true } }
          }
        });

        // === Survival by Family Size ===
        passengers.forEach(p => p.FamilySize = p.SibSp + p.Parch);
        const familyGroups = groupBy(passengers, "FamilySize");
        const famLabels = Object.keys(familyGroups);
        const famSurvival = famLabels.map(f => {
          const group = familyGroups[f];
          return group.filter(p => p.Survived === 1).length / group.length * 100;
        });

        new Chart(document.getElementById("familyChart"), {
          type: "line",
          data: {
            labels: famLabels,
            datasets: [{
              label: "% Survived",
              data: famSurvival,
              borderColor: "#ff4d6d",
              backgroundColor: "#ff99ac",
              fill: true
            }]
          },
          options: {
            plugins: { title: { display: true, text: "Survival by Family Size" } },
            scales: { y: { ticks: { color: "#fff" }, beginAtZero: true } }
          }
        });

        // === Survival by Embarkation Port ===
        const embarkGroups = groupBy(passengers, "Embarked");
        const embarkLabels = Object.keys(embarkGroups);
        const embarkSurvival = embarkLabels.map(e => {
          const group = embarkGroups[e];
          return group.filter(p => p.Survived === 1).length / group.length * 100;
        });

        new Chart(document.getElementById("embarkChart"), {
          type: "bar",
          data: {
            labels: embarkLabels.map(e => (e === "S" ? "Southampton" : e === "C" ? "Cherbourg" : "Queenstown")),
            datasets: [{
              label: "% Survived",
              data: embarkSurvival,
              backgroundColor: ["#800000", "#b3003b", "#ff4d6d"]
            }]
          },
          options: {
            plugins: { title: { display: true, text: "Survival by Embarkation Port" } },
            scales: { y: { ticks: { color: "#fff" }, beginAtZero: true } }
          }
        });

        // === Survival by Fare Quartile ===
        const fares = passengers.map(p => p.Fare).sort((a,b)=>a-b);
        function quantile(arr, q) {
          const pos = (arr.length-1)*q;
          const base = Math.floor(pos);
          const rest = pos-base;
          return arr[base] + (arr[base+1]-arr[base]) * rest;
        }
        const q1 = quantile(fares, 0.25), q2 = quantile(fares, 0.5), q3 = quantile(fares, 0.75);
        passengers.forEach(p => {
          if (p.Fare <= q1) p.FareGroup = "Q1";
          else if (p.Fare <= q2) p.FareGroup = "Q2";
          else if (p.Fare <= q3) p.FareGroup = "Q3";
          else p.FareGroup = "Q4";
        });
        const fareGroups = groupBy(passengers, "FareGroup");
        const fareLabels = Object.keys(fareGroups);
        const fareSurvival = fareLabels.map(f => {
          const group = fareGroups[f];
          return group.filter(p => p.Survived === 1).length / group.length * 100;
        });

        new Chart(document.getElementById("fareChart"), {
          type: "bar",
          data: {
            labels: fareLabels,
            datasets: [{
              label: "% Survived",
              data: fareSurvival,
              backgroundColor: ["#800000", "#b3003b", "#ff4d6d", "#ff99ac"]
            }]
          },
          options: {
            plugins: { title: { display: true, text: "Survival by Fare Quartile" } },
            scales: { y: { ticks: { color: "#fff" }, beginAtZero: true } }
          }
        });

        // === Correlation Heatmap ===
        const numericCols = ["Survived","Pclass","Age","SibSp","Parch","Fare","FamilySize"];
        const matrix = numericCols.map(row => numericCols.map(col => {
          const x = passengers.map(p => p[row]).filter(v => v !== undefined && !isNaN(v));
          const y = passengers.map(p => p[col]).filter(v => v !== undefined && !isNaN(v));
          const meanX = x.reduce((a,b)=>a+b,0)/x.length;
          const meanY = y.reduce((a,b)=>a+b,0)/y.length;
          const num = x.map((v,i)=>(v-meanX)*(y[i]-meanY)).reduce((a,b)=>a+b,0);
          const den = Math.sqrt(x.map(v=>(v-meanX)**2).reduce((a,b)=>a+b,0) * y.map(v=>(v-meanY)**2).reduce((a,b)=>a+b,0));
          return num/den;
        }));

        new Chart(document.getElementById("corrHeatmap"), {
          type: "matrix",
          data: {
            labels: numericCols,
            datasets: [{
              label: "Correlation",
              data: matrix.flatMap((row,i) => row.map((val,j)=>({x:j,y:i,v:val}))),
              backgroundColor: ctx => {
                const value = ctx.dataset.data[ctx.dataIndex].v;
                const alpha = Math.abs(value);
                return value > 0 ? `rgba(178, 0, 59, ${alpha})` : `rgba(255, 77, 109, ${alpha})`;
              },
              borderWidth: 1,
              width: ({chart}) => (chart.chartArea.width / numericCols.length)-2,
              height: ({chart}) => (chart.chartArea.height / numericCols.length)-2
            }]
          },
          options: {
            plugins: {
              title: { display: true, text: "Correlation Heatmap" },
              tooltip: {
                callbacks: { label: ctx => ctx.raw.v.toFixed(2) }
              }
            },
            scales: {
              x: { ticks: { color: "#fff" }, labels: numericCols },
              y: { ticks: { color: "#fff" }, labels: numericCols }
            }
          }
        });
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@1.2.0/dist/chartjs-chart-matrix.min.js"></script>
</body>
</html>
