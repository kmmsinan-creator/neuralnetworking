<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D EDA Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    body {
      background: #0b0e19;
      color: #f1f1f1;
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
    }
    h1 {
      text-align: center;
      padding: 20px;
      color: #9bd1ff;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .chart-box {
      background: #161a2b;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    }
    #filters {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 10px;
    }
    select {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background: #1f253d;
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>ðŸš¢ Titanic 3D EDA Dashboard</h1>

  <div id="filters">
    <label>
      Filter by Sex:
      <select id="sexFilter">
        <option value="all">All</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
    </label>
    <label>
      Filter by Pclass:
      <select id="classFilter">
        <option value="all">All</option>
        <option value="1">Class 1</option>
        <option value="2">Class 2</option>
        <option value="3">Class 3</option>
      </select>
    </label>
  </div>

  <div class="grid">
    <div class="chart-box"><div id="survival3D"></div></div>
    <div class="chart-box"><div id="ageFare3D"></div></div>
    <div class="chart-box"><div id="pclassPie3D"></div></div>
  </div>

<script>
// Load Titanic dataset from GitHub or local (replace with your path if needed)
const DATA_URL = "https://raw.githubusercontent.com/datasciencedojo/datasets/master/titanic.csv";

// Apply filters
function applyFilters(data) {
  let sex = document.getElementById("sexFilter").value;
  let pclass = document.getElementById("classFilter").value;

  return data.filter(d => 
    (sex === "all" || d.Sex === sex) &&
    (pclass === "all" || d.Pclass == pclass)
  );
}

// Draw charts
function drawCharts(data) {
  // 1. Survival 3D bar
  let survivedCounts = [0,0];
  data.forEach(d => survivedCounts[d.Survived]++);
  let survivalTrace = {
    x: ["Died","Survived"],
    y: survivedCounts,
    z: [0,0],
    type: "bar3d" // not native, we fake with bars extruded along Z
  };

  let survivalFig = {
    data: [{
      type: "bar3d", // fallback to 3d scatter bars
      x: ["Died","Survived"],
      y: [0,0],
      z: survivedCounts,
      marker: {color: ["#ff6b6b","#4ecdc4"]},
      text: survivedCounts.map(c=>`Count: ${c}`),
      hoverinfo:"text"
    }],
    layout: {
      title:"Survival Count (3D)",
      scene:{
        xaxis:{title:"Outcome"},
        yaxis:{title:"Axis Y"},
        zaxis:{title:"Count"},
        camera:{eye:{x:1.8,y:1.8,z:1.2}}
      },
      transition:{duration:800}
    }
  };
  Plotly.newPlot("survival3D", survivalFig);

  // 2. Age vs Fare scatter 3D
  let age = data.map(d=>+d.Age).filter(a=>!isNaN(a));
  let fare = data.map(d=>+d.Fare).filter(f=>!isNaN(f));
  let survived = data.map(d=>d.Survived);

  let scatterFig = {
    data:[{
      type:"scatter3d",
      mode:"markers",
      x: age,
      y: fare,
      z: survived,
      marker:{
        size:4,
        color: survived,
        colorscale:["#ff6b6b","#4ecdc4"],
        opacity:0.8
      },
      text: survived.map(s=>s?"Survived":"Died"),
      hoverinfo:"x+y+z+text"
    }],
    layout:{
      title:"Age vs Fare vs Survival",
      scene:{
        xaxis:{title:"Age"},
        yaxis:{title:"Fare"},
        zaxis:{title:"Survived"},
        camera:{eye:{x:2,y:1.2,z:0.8}}
      }
    }
  };
  Plotly.newPlot("ageFare3D", scatterFig);

  // 3. Pclass Pie as 3D surface donut
  let pclassCounts = {1:0,2:0,3:0};
  data.forEach(d => pclassCounts[d.Pclass]++);
  let values = Object.values(pclassCounts);
  let labels = Object.keys(pclassCounts);

  let pieFig = {
    data:[{
      type:"pie",
      values: values,
      labels: labels,
      hole: 0.4,
      textinfo:"label+percent",
      hovertemplate:"Class %{label}<br>Count %{value}<extra></extra>",
      marker:{colors:["#5dade2","#58d68d","#f4d03f"]}
    }],
    layout:{
      title:"Passenger Class Distribution (3D-style Donut)",
    }
  };
  Plotly.newPlot("pclassPie3D", pieFig);
}

// Load data and bind filters
fetch(DATA_URL)
  .then(r=>r.text())
  .then(txt=>{
    let rows = txt.split("\n").map(r=>r.split(","));
    let headers = rows[0];
    let data = rows.slice(1).filter(r=>r.length===headers.length).map(r=>{
      let obj={};
      headers.forEach((h,i)=> obj[h]=r[i]);
      return obj;
    });

    function update() {
      let filtered = applyFilters(data);
      drawCharts(filtered);
    }
    document.getElementById("sexFilter").addEventListener("change", update);
    document.getElementById("classFilter").addEventListener("change", update);
    update();
  });
</script>
</body>
</html>
