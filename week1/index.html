<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Titanic Survivors' Tales â€” EDA Dashboard</title>

<!-- Libs -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@2.0.1/dist/chartjs-chart-matrix.min.js"></script>

<style>
:root{--ink:#f5f5f5;--muted:#d9d9d9;--card:rgba(0,0,0,.55);--shadow:0 14px 35px rgba(0,0,0,.5);}
body{min-height:100vh;color:var(--ink);padding:28px;
  background:linear-gradient(rgba(0,0,0,0.6),rgba(0,0,0,0.6)),
  url("https://upload.wikimedia.org/wikipedia/commons/f/fd/RMS_Titanic_3.jpg") no-repeat center center fixed;
  background-size:cover;}
.container{max-width:1200px;margin:0 auto}
.panel{background:var(--card);border-radius:20px;box-shadow:var(--shadow);padding:18px;margin-bottom:20px}
.section h2{font-size:1.2rem;margin-bottom:10px}
.chart{position:relative;height:320px}
</style>
</head>
<body>
<div class="container">
  <div class="panel"><div class="section"><h2>Survival by Passenger Class</h2></div><div class="chart"><canvas id="survivalClass"></canvas></div></div>
  <div class="panel"><div class="section"><h2>Survival by Embarkation Port</h2></div><div class="chart"><canvas id="survivalEmbark"></canvas></div></div>
  <div class="panel"><div class="section"><h2>Survival by Family Size</h2></div><div class="chart"><canvas id="survivalFamily"></canvas></div></div>
  <div class="panel"><div class="section"><h2>Survival by Fare Quartile</h2></div><div class="chart"><canvas id="survivalFare"></canvas></div></div>
  <div class="panel"><div class="section"><h2>Correlation Heatmap</h2></div><div class="chart"><canvas id="corrHeatmap"></canvas></div></div>
</div>

<script>
const CSV_URL = "train.csv";
const pct = (x)=>Math.round(x*1000)/10;
const famBucket = (x)=>{const v=(+x)||0;return v>=6?"6+":String(v)};
const chartColors = ["#ffcc66","#ff6666","#66b3ff","#99ff99","#ffb366","#d9b3ff","#66e0ff"];

// Bar chart helper
function drawBar(ctx, labels, data, title, counts){
  return new Chart(ctx,{type:"bar",data:{labels,
    datasets:[{label:title,data,borderWidth:2,backgroundColor:chartColors,borderColor:"#fff"}]},
    options:{responsive:true,maintainAspectRatio:false,
      plugins:{legend:{labels:{color:"#fff"}},tooltip:{callbacks:{label:(c)=>`${c.formattedValue}% (${counts[c.dataIndex]})`}},title:{display:true,text:title,color:"#fff"}},
      scales:{y:{beginAtZero:true,ticks:{color:"#fff",callback:v=>v+"%"}},x:{ticks:{color:"#fff"}}}}});
}

// Load data
async function loadCSV(){
  const res=await fetch(CSV_URL);const txt=await res.text();
  return new Promise(r=>Papa.parse(txt,{header:true,dynamicTyping:true,complete:p=>r(p.data)}));
}

loadCSV().then(data=>{
  // Passenger Class
  const cls={};data.forEach(p=>{if(!cls[p.Pclass])cls[p.Pclass]={s:0,t:0};cls[p.Pclass].t++;if(p.Survived===1)cls[p.Pclass].s++;});
  const cLabels=Object.keys(cls).map(c=>"Class "+c);
  const cRates=Object.keys(cls).map(c=>pct(cls[c].s/cls[c].t));
  const cCounts=Object.keys(cls).map(c=>`${cls[c].s}/${cls[c].t}`);
  drawBar(document.getElementById("survivalClass"),cLabels,cRates,"Survival by Passenger Class",cCounts);

  // Embarkation
  const portNames={"C":"Cherbourg","Q":"Queenstown","S":"Southampton"};const ports={};
  data.forEach(p=>{const port=portNames[p.Embarked]||"Unknown";if(!ports[port])ports[port]={s:0,t:0};ports[port].t++;if(p.Survived===1)ports[port].s++;});
  const pLabels=Object.keys(ports),pRates=pLabels.map(l=>pct(ports[l].s/ports[l].t)),pCounts=pLabels.map(l=>`${ports[l].s}/${ports[l].t}`);
  drawBar(document.getElementById("survivalEmbark"),pLabels,pRates,"Survival by Embarkation Port",pCounts);

  // Family Size
  const fam={};data.forEach(p=>{const f=(p.SibSp||0)+(p.Parch||0);const b=famBucket(f);if(!fam[b])fam[b]={s:0,t:0};fam[b].t++;if(p.Survived===1)fam[b].s++;});
  const fLabels=Object.keys(fam),fRates=fLabels.map(l=>pct(fam[l].s/fam[l].t)),fCounts=fLabels.map(l=>`${fam[l].s}/${fam[l].t}`);
  drawBar(document.getElementById("survivalFamily"),fLabels,fRates,"Survival by Family Size",fCounts);

  // Fare Quartile
  const fares=data.map(p=>p.Fare).filter(f=>!isNaN(f)).sort((a,b)=>a-b);
  const q1=fares[Math.floor(fares.length*0.25)],q2=fares[Math.floor(fares.length*0.5)],q3=fares[Math.floor(fares.length*0.75)];
  const quart=f=>f<=q1?"Q1 (Lowest)":f<=q2?"Q2":f<=q3?"Q3":"Q4 (Highest)";
  const fare={};data.forEach(p=>{const b=quart(p.Fare||0);if(!fare[b])fare[b]={s:0,t:0};fare[b].t++;if(p.Survived===1)fare[b].s++;});
  const faLabels=Object.keys(fare),faRates=faLabels.map(l=>pct(fare[l].s/fare[l].t)),faCounts=faLabels.map(l=>`${fare[l].s}/${fare[l].t}`);
  drawBar(document.getElementById("survivalFare"),faLabels,faRates,"Survival by Fare Quartile",faCounts);

  // Correlation Heatmap
  const features=["Survived","Pclass","Age","SibSp","Parch","Fare"];
  const rows=data.filter(d=>features.every(k=>d[k]!==""&&d[k]!=null&&!isNaN(d[k])));
  const arr=rows.map(d=>features.map(k=>+d[k]));
  const corr=(x,y)=>{const mx=x.reduce((a,b)=>a+b)/x.length,my=y.reduce((a,b)=>a+b)/y.length;
    let num=0,dx=0,dy=0;for(let i=0;i<x.length;i++){num+=(x[i]-mx)*(y[i]-my);dx+=(x[i]-mx)**2;dy+=(y[i]-my)**2;}
    return num/Math.sqrt(dx*dy);};
  const matrix=[];features.forEach((a,i)=>features.forEach((b,j)=>{const xi=arr.map(r=>r[i]),yi=arr.map(r=>r[j]);matrix.push({x:i,y:j,v:corr(xi,yi)});}));  
  new Chart(document.getElementById("corrHeatmap"),{type:"matrix",data:{datasets:[{label:"Correlation",data:matrix,width:20,height:20,backgroundColor:(c)=>{const v=c.dataset.data[c.dataIndex].v;const r=Math.floor((v+1)/2*255),b=255-r;return `rgba(${r},50,${b},0.8)`;},borderWidth:1,borderColor:"#000"}]},options:{scales:{x:{type:"category",labels:features,grid:{display:false},ticks:{color:"#fff"}},y:{type:"category",labels:features.reverse(),grid:{display:false},ticks:{color:"#fff"}}},plugins:{tooltip:{callbacks:{title:ctx=>{const d=ctx[0].raw;return features[d.x]+" vs "+features[d.y];},label:ctx=>"Corr: "+ctx.raw.v.toFixed(2)}}}}); 
});
</script>
</body>
</html>
